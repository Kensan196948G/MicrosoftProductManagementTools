# ~/.tmux.conf - Microsoft製品管理ツール開発環境用tmux設定

# 基本設定
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# itmux/mintty環境最適化
set -g mouse on
set -g default-terminal "screen-256color"
set -g terminal-overrides "xterm*:Tc"
set -g base-index 1
set -g pane-base-index 1

# Windows/Cygwin統合
set -g default-shell "/bin/bash"
set -g history-limit 10000
set -g escape-time 0

# ウィンドウ・ペイン操作（Microsoft製品管理ツール開発向け）
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# ペイン移動（vim風）
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ペインリサイズ（矢印キー対応）
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ペインリサイズ（矢印キー）
bind -r Left resize-pane -L 5
bind -r Down resize-pane -D 5
bind -r Up resize-pane -U 5
bind -r Right resize-pane -R 5

# PowerShell/CMD統合
bind P new-window -n "PowerShell" 'cmd.exe /c powershell.exe'
bind C new-window -n "CMD" 'cmd.exe'
bind W new-window -n "WinTools" 'cmd.exe /c "cd /d C:\tools && powershell.exe"'

# クリップボード統合（Windows）
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "/dev/clipboard"
bind ] run "cat /dev/clipboard | tmux load-buffer - ; tmux paste-buffer"

# Microsoft製品管理ツール特化バインド
bind G new-window -n "GUI-App" 'cd /cygdrive/c/workspace/MicrosoftProductManagementTools && bash'
bind A new-window -n "CLI-App" 'cd /cygdrive/c/workspace/MicrosoftProductManagementTools && bash'
bind S new-window -n "Scripts" 'cd /cygdrive/c/workspace/MicrosoftProductManagementTools/Scripts && bash'
bind T new-window -n "Test" 'cd /cygdrive/c/workspace/MicrosoftProductManagementTools/TestScripts && bash'
bind R new-window -n "Reports" 'cd /cygdrive/c/workspace/MicrosoftProductManagementTools/Reports && bash'
bind D new-window -n "Docs" 'cd /cygdrive/c/workspace/MicrosoftProductManagementTools/Docs && bash'

# 開発作業用ショートカット
bind M new-window -n "M365-Scripts" 'cd /cygdrive/c/workspace/MicrosoftProductManagementTools/Scripts/EntraID && bash'
bind E new-window -n "Exchange" 'cd /cygdrive/c/workspace/MicrosoftProductManagementTools/Scripts/EXO && bash'
bind O new-window -n "OneDrive" 'cd /cygdrive/c/workspace/MicrosoftProductManagementTools/Scripts/OneDrive && bash'

# セッション管理
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"
bind X confirm-before -p "kill-session #S? (y/n)" kill-session

# ステータスバー（Microsoft製品管理ツール開発向け）
set -g status-position bottom
set -g status-bg colour234
set -g status-fg colour137
set -g status-interval 1
set -g status-left '#[fg=colour233,bg=colour245,bold] 🎯 M365-Tools #[fg=colour245,bg=colour235,nobold]'
set -g status-right '#[fg=colour233,bg=colour245,bold] %m/%d %H:%M:%S '
set -g status-right-length 50
set -g status-left-length 30

# ウィンドウ表示（セクション名表示）
setw -g window-status-current-format ' #I#[fg=colour250]:#[fg=colour255]#W#[fg=colour50]#F '
setw -g window-status-format ' #I#[fg=colour237]:#[fg=colour250]#W#[fg=colour244]#F '

# ペイン境界（視認性向上）
set -g pane-border-style 'fg=colour238 bg=colour235'
set -g pane-active-border-style 'fg=colour51 bg=colour235'

# メッセージスタイル
set -g message-style 'fg=colour232 bg=colour166 bold'

# コピーモード設定
setw -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection-and-cancel

# ペインの自動分割設定（開発者向け）
# 4ペイン構成の自動作成
bind 4 split-window -h \; split-window -v \; select-pane -t 0 \; split-window -v

# Microsoft製品管理ツール専用コマンド
bind-key M-g run-shell "cd /cygdrive/c/workspace/MicrosoftProductManagementTools && cmd.exe /c 'powershell.exe -File Apps/GuiApp_Enhanced.ps1'"
bind-key M-c run-shell "cd /cygdrive/c/workspace/MicrosoftProductManagementTools && cmd.exe /c 'powershell.exe -File Apps/CliApp_Enhanced.ps1'"
bind-key M-t run-shell "cd /cygdrive/c/workspace/MicrosoftProductManagementTools && cmd.exe /c 'powershell.exe -File TestScripts/test-all-features.ps1'"

# ログ管理
bind-key M-l run-shell "cd /cygdrive/c/workspace/MicrosoftProductManagementTools/Logs && ls -la"

# 緊急時の全セッション終了
bind-key M-q confirm-before -p "kill all sessions? (y/n)" "run-shell 'tmux kill-server'"

# 開発効率化
set -g renumber-windows on
set -g automatic-rename on
set -g automatic-rename-format '#(basename #{pane_current_path})'

# 日本語対応
set -g status-utf8 on
setw -g utf8 on