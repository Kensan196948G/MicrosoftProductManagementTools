# 📘 ITSM/ISO27001/27002準拠 Microsoft製品運用管理ツール 仕様書（ベストプラクティス統合版）Ver. 2.0

---

## 🎯 1. 目的と背景

Active Directory、Microsoft Entra ID（旧AzureAD）、Exchange Online、OneDrive、Microsoft Teams などの Microsoft 365 製品群における運用業務の可視化・自動化・証跡化を目的とし、
**ITSM（ISO/IEC 20000）** と **情報セキュリティ管理（ISO/IEC 27001・27002）** に完全準拠した自動化運用ツールを構築・運用するための統合仕様書。

---

## 🧩 2. 準拠基準

* ✅ ISO/IEC 20000（ITサービスマネジメント）
* ✅ ISO/IEC 27001（情報セキュリティ管理システム）
* ✅ ISO/IEC 27002（情報セキュリティ管理策ガイドライン）

---

## 👥 3. 適用対象

* 👨‍💼 IT管理者／システム運用担当者
* 🔐 セキュリティ管理者／SOC担当
* 🧾 内部統制／ISMS監査担当者

---

## 🧱 4. フォルダ構成（ルートディレクトリ）

```plaintext
MicrosoftProductManagementTools/
├── Scripts/
│   ├── AD/             ← Active Directory 管理
│   ├── EXO/            ← Exchange Online 管理
│   ├── EntraID/        ← Entra ID / Microsoft Graph 管理
│   └── Common/         ← 共通関数・認証・ロギング処理
│
├── Reports/            ← 自動生成レポート出力先（HTML/CSV）
│   ├── Daily/
│   ├── Weekly/
│   ├── Monthly/
│   └── Yearly/
│
├── Logs/               ← 実行ログ／エラーログ／証跡ログ
│   └── YYYYMMDD/
│
├── Config/             ← 認証設定（証明書／シークレット）
│   └── appsettings.json
│
├── Templates/          ← HTMLテンプレート群
└── README.md           ← 利用手順・管理者ガイド
```

---

## 🖥️ 5. システム要件

| 項目             | 要件内容                                                                   |
| -------------- | ---------------------------------------------------------------------- |
| OS             | Windows 10/11 Pro or Server 2016以降                                     |
| PowerShell     | v5.1 または PowerShell 7（Core対応）                                          |
| .NET Framework | v4.8（PS5.1用）                                                           |
| モジュール          | ExchangeOnlineManagement, Microsoft.Graph, AzureAD（必要に応じて）             |
| 認証方式           | 非対話型（証明書またはクライアントシークレット）／EntraID アプリ登録必要 ExchangeOnline：証明書認証（登録済みとする） |
| 実行ポリシー         | RemoteSigned または Bypass（自動スケジュール対応）                                    |
| スケジューラー        | Windowsタスクスケジューラー or Azure Automation                                  |
| 出力形式           | HTML（可読性）＋CSV（保管・証跡）                                                   |
| 保管要件           | 改ざん不可（アクセス制御・WORM・バージョン管理推奨）                                           |
| 実行権限           | 読み取り・レポート出力に必要な最低権限（全体管理者は不要）                                          |

---

## 🛠️ 6. 管理・監視機能マトリクス

### 👤 ユーザー管理（UM系）

* ログイン履歴抽出（無操作検出）
* ログイン失敗アラート検出
* MFA未設定者抽出
* パスワード有効期限チェック
* ライセンス未割当者確認
* ユーザー属性変更履歴確認
* Microsoft 365ライセンス付与の有無確認

### 🏷️ グループ管理（GM系）

* グループ一覧・構成抽出
* メンバー棚卸レポート出力
* 動的グループ設定確認
* グループ属性およびロール確認

### 📬 Exchange Online（EX系）

* メールボックス容量・上限監視
* 添付ファイル送信履歴分析
* 自動転送・返信設定の確認
* メール配送遅延・障害監視
* 配布グループ整合性チェック
* 会議室リソース利用状況監査
* スパム・フィッシング傾向分析
* Exchangeライセンス有効性チェック

### 📂 OneDrive／Teams／ライセンス（OD/TM/LM系）

* OneDrive使用容量／残容量の分析
* Teams構成確認（チーム一覧、録画設定、オーナー不在）
* OneDrive外部共有状況確認
* ライセンス配布状況・未使用ライセンス監視
* 利用率／アクティブ率レポート
* 年間消費傾向のアラート出力

---

## 📊 7. レポート運用と証跡管理

### レポート種別

| 種類     | 主な内容                         |
| ------ | ---------------------------- |
| 🗓️ 日次 | ログイン失敗、容量監視、添付分析、ADログ等       |
| 📅 週次  | MFA設定状況、外部共有、配布グループ棚卸        |
| 📆 月次  | 利用率・容量・権限レビュー、会議室棚卸、スパム傾向分析  |
| 📈 年次  | ライセンス消費、インシデント統計、改善履歴、証跡一括出力 |

### 出力・保管方式

* **HTML（ダッシュボード／帳票）＋CSV（構造化保管）**
* **自動スケジュール実行（PowerShell＋タスクスケジューラー）**
* **改ざん不可：タイムスタンプ＋WORM＋アクセス制御にて証跡保管**

---

## 🧠 8. エラーハンドリングと自律復旧

* エラー発生時、自動ログ取得＋通知
* 再試行最大7回までの自律修復ループ設計
* ErrorHandlingモジュールによる統一例外処理
* 実行ログ／エラーログ／監査ログは用途別に分離し最長1年保管

---

## ✅ 9. 活用効果と今後の拡張

* ITSM運用手順の明文化と自動化
* ISO27001/27002への適合（証跡・可視化・定期棚卸）
* 属人化排除／システム監査対応力の強化
* 将来的な Intune／SharePoint Online との統合にも拡張可能

---

**最終更新：2025年6月版**
