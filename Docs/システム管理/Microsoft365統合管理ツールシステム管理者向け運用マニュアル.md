# ğŸ› ï¸ Microsoft 365çµ±åˆç®¡ç†ãƒ„ãƒ¼ãƒ« ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…å‘ã‘é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«

## ğŸ“‹ é‹ç”¨ç®¡ç†æ¦‚è¦

### ğŸ¯ ç®¡ç†è€…ã®å½¹å‰²ãƒ»è²¬ä»»
Microsoft 365çµ±åˆç®¡ç†ãƒ„ãƒ¼ãƒ«ã®ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã¨ã—ã¦ã€ä»¥ä¸‹ã®é‹ç”¨æ¥­å‹™ã‚’æ‹…å½“ã„ãŸã ãã¾ã™ï¼š

#### ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»èªè¨¼ç®¡ç†
- ğŸ« **è¨¼æ˜æ›¸ãƒ™ãƒ¼ã‚¹èªè¨¼**: ã‚»ã‚­ãƒ¥ã‚¢ãªAPIæ¥ç¶šã®ç¶­æŒ
- ğŸ”‘ **ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ç®¡ç†**: æœ€å°æ¨©é™åŸå‰‡ã®å¾¹åº•
- ğŸ“ **ç›£æŸ»è¨¼è·¡**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°ã®å®šæœŸç¢ºèª
- ğŸ›¡ï¸ **è„†å¼±æ€§å¯¾å¿œ**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒã®è¿…é€Ÿé©ç”¨

#### ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–ãƒ»ä¿å®ˆ
- âš¡ **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**: ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³ã®ç¢ºèª
- ğŸ”„ **å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹**: ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- ğŸ“ˆ **å®¹é‡ç®¡ç†**: ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ãƒ»ãƒ¬ãƒãƒ¼ãƒˆä¿å­˜é ˜åŸŸã®ç®¡ç†
- ğŸš¨ **ã‚¢ãƒ©ãƒ¼ãƒˆå¯¾å¿œ**: ã‚·ã‚¹ãƒ†ãƒ ç•°å¸¸ã®è¿…é€Ÿãªå¯¾å‡¦

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†

### ğŸ« èªè¨¼è¨­å®šãƒ»ç®¡ç†

#### ğŸ“± Azure ADã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç™»éŒ²
```powershell
# Azure ADç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼ã§ã®è¨­å®šé …ç›®
https://aad.portal.azure.com/

ã€å¿…è¦è¨­å®šã€‘
âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å: Microsoft365-IntegratedManagement
âœ… ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç¨®é¡: ã“ã®çµ„ç¹”ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã¿
âœ… ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURI: ä¸è¦ï¼ˆéå¯¾è©±å‹èªè¨¼ï¼‰
âœ… è¨¼æ˜æ›¸ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
```

#### ğŸ”’ å¿…è¦ãªAPIã‚¢ã‚¯ã‚»ã‚¹è¨±å¯
```json
{
  "requiredResourceAccess": [
    {
      "resourceAppId": "00000003-0000-0000-c000-000000000000",
      "resourceAccess": [
        {"id": "e1fe6dd8-ba31-4d61-89e7-88639da4683d", "type": "Role"},
        {"id": "df021288-bdef-4463-88db-98f22de89214", "type": "Role"},
        {"id": "230c1aed-a721-4c5d-9cb4-a90514e508ef", "type": "Role"},
        {"id": "7ab1d382-f21e-4acd-a863-ba3e13f7da61", "type": "Role"}
      ]
    }
  ]
}
```

**ğŸ¯ æ¨©é™è©³ç´°:**
- ğŸ“Š `User.Read.All` - ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±èª­ã¿å–ã‚Š
- ğŸ¢ `Group.Read.All` - ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±èª­ã¿å–ã‚Š
- ğŸ“§ `Mail.Read` - ãƒ¡ãƒ¼ãƒ«çµ±è¨ˆèª­ã¿å–ã‚Š
- ğŸ« `Directory.Read.All` - ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæƒ…å ±èª­ã¿å–ã‚Š
- ğŸ“Š `Reports.Read.All` - ä½¿ç”¨çŠ¶æ³ãƒ¬ãƒãƒ¼ãƒˆèª­ã¿å–ã‚Š
- â˜ï¸ `Files.Read.All` - OneDriveæƒ…å ±èª­ã¿å–ã‚Š

#### ğŸ”‘ è¨¼æ˜æ›¸ç®¡ç†æ‰‹é †

##### ğŸ“œ è¨¼æ˜æ›¸ç”Ÿæˆï¼ˆPowerShellï¼‰
```powershell
# è‡ªå·±ç½²åè¨¼æ˜æ›¸ã®ä½œæˆ
$cert = New-SelfSignedCertificate -Subject "CN=Microsoft365-IntegratedManagement" `
                                  -CertStoreLocation "Cert:\CurrentUser\My" `
                                  -KeyExportPolicy Exportable `
                                  -KeySpec Signature `
                                  -KeyLength 2048 `
                                  -KeyAlgorithm RSA `
                                  -HashAlgorithm SHA256

# è¨¼æ˜æ›¸ã®æƒ…å ±è¡¨ç¤º
$cert | Format-List Subject, Thumbprint, NotAfter

# å…¬é–‹ã‚­ãƒ¼ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆAzure ADã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”¨ï¼‰
Export-Certificate -Cert $cert -FilePath "C:\temp\Microsoft365-IntegratedManagement.cer"
```

##### ğŸ”„ è¨¼æ˜æ›¸ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
```powershell
# è¨¼æ˜æ›¸æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯ï¼ˆå®šæœŸå®Ÿè¡Œæ¨å¥¨ï¼‰
function Test-CertificateExpiry {
    param([string]$Thumbprint)
    
    $cert = Get-ChildItem -Path "Cert:\CurrentUser\My\$Thumbprint" -ErrorAction SilentlyContinue
    if (-not $cert) {
        Write-Error "è¨¼æ˜æ›¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $Thumbprint"
        return
    }
    
    $daysUntilExpiry = ($cert.NotAfter - (Get-Date)).Days
    
    if ($daysUntilExpiry -lt 30) {
        Write-Warning "âš ï¸ è¨¼æ˜æ›¸ã®æœ‰åŠ¹æœŸé™ãŒè¿‘ã¥ã„ã¦ã„ã¾ã™: $daysUntilExpiry æ—¥"
        return $false
    }
    
    Write-Host "âœ… è¨¼æ˜æ›¸ã¯æœ‰åŠ¹ã§ã™: ã‚ã¨ $daysUntilExpiry æ—¥"
    return $true
}

# ä½¿ç”¨ä¾‹
Test-CertificateExpiry -Thumbprint "YOUR_CERTIFICATE_THUMBPRINT"
```

### ğŸ›¡ï¸ ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ»æ¨©é™ç®¡ç†

#### ğŸ‘¥ å½¹å‰²ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
```powershell
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã®æ¨©é™ç®¡ç†ä¾‹
{
  "UserRoles": {
    "SystemAdmin": {
      "Permissions": ["ALL"],
      "Users": ["admin@contoso.com"]
    },
    "ITManager": {
      "Permissions": ["READ_REPORTS", "GENERATE_REPORTS"],
      "Users": ["itmanager@contoso.com"]
    },
    "Operator": {
      "Permissions": ["READ_BASIC"],
      "Users": ["operator@contoso.com"]
    }
  }
}
```

#### ğŸ“ ç›£æŸ»ãƒ­ã‚°è¨­å®š
```powershell
# ãƒ­ã‚°è¨­å®šä¾‹ï¼ˆappsettings.jsonï¼‰
{
  "Logging": {
    "AuditLog": {
      "Enabled": true,
      "Level": "Information",
      "RetentionDays": 365,
      "Path": "Logs/Audit",
      "Format": "JSON"
    },
    "SecurityLog": {
      "Enabled": true,
      "Level": "Warning",
      "RetentionDays": 1095,
      "Path": "Logs/Security",
      "IncludeStackTrace": true
    }
  }
}
```

---

## ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–ãƒ»ä¿å®ˆ

### âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

#### ğŸ–¥ï¸ ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ç›£è¦–
```powershell
# ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡ç¢ºèªã‚¹ã‚¯ãƒªãƒ—ãƒˆ
function Get-SystemResourceUsage {
    $cpu = Get-Counter "\Processor(_Total)\% Processor Time" | 
           Select-Object -ExpandProperty CounterSamples | 
           Select-Object -ExpandProperty CookedValue
    
    $memory = Get-Counter "\Memory\Available MBytes" | 
              Select-Object -ExpandProperty CounterSamples | 
              Select-Object -ExpandProperty CookedValue
    
    $disk = Get-WmiObject -Class Win32_LogicalDisk -Filter "DeviceID='C:'" | 
            Select-Object @{Name="FreeSpaceGB";Expression={[math]::Round($_.FreeSpace/1GB,2)}},
                         @{Name="TotalSpaceGB";Expression={[math]::Round($_.Size/1GB,2)}}
    
    [PSCustomObject]@{
        CPUUsage = [math]::Round($cpu, 2)
        AvailableMemoryMB = [math]::Round($memory, 2)
        DiskFreeSpaceGB = $disk.FreeSpaceGB
        DiskTotalSpaceGB = $disk.TotalSpaceGB
        Timestamp = Get-Date
    }
}

# ä½¿ç”¨ä¾‹ï¼ˆå®šæœŸå®Ÿè¡Œæ¨å¥¨ï¼‰
Get-SystemResourceUsage | Format-Table -AutoSize
```

#### ğŸ“ˆ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç›£è¦–
```powershell
# Microsoft Graph APIæ¥ç¶šç›£è¦–
function Test-GraphAPIConnection {
    try {
        $context = Get-MgContext
        if ($null -eq $context) {
            return @{
                Status = "Disconnected"
                Message = "Microsoft Graphæœªæ¥ç¶š"
                Timestamp = Get-Date
            }
        }
        
        # ç°¡å˜ãªAPIå‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆ
        $testUser = Get-MgUser -Top 1 -Property Id
        
        return @{
            Status = "Connected"
            Message = "Microsoft Graphæ¥ç¶šæ­£å¸¸"
            TenantId = $context.TenantId
            Account = $context.Account
            Timestamp = Get-Date
        }
    }
    catch {
        return @{
            Status = "Error"
            Message = $_.Exception.Message
            Timestamp = Get-Date
        }
    }
}

# Exchange Onlineæ¥ç¶šç›£è¦–
function Test-ExchangeOnlineConnection {
    try {
        $session = Get-PSSession | Where-Object {$_.ConfigurationName -eq "Microsoft.Exchange"}
        if ($session) {
            $testMailbox = Get-Mailbox -ResultSize 1
            return @{
                Status = "Connected"
                Message = "Exchange Onlineæ¥ç¶šæ­£å¸¸"
                SessionState = $session.State
                Timestamp = Get-Date
            }
        }
        else {
            return @{
                Status = "Disconnected"
                Message = "Exchange Onlineæœªæ¥ç¶š"
                Timestamp = Get-Date
            }
        }
    }
    catch {
        return @{
            Status = "Error"
            Message = $_.Exception.Message
            Timestamp = Get-Date
        }
    }
}
```

### ğŸ—‚ï¸ ãƒ­ã‚°ç®¡ç†ãƒ»ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

#### ğŸ“ ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 
```
Logs/
â”œâ”€â”€ System/
â”‚   â”œâ”€â”€ System_20250613.log        # ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ï¼ˆæ—¥æ¬¡ï¼‰
â”‚   â”œâ”€â”€ Error_20250613.log         # ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ï¼ˆæ—¥æ¬¡ï¼‰
â”‚   â””â”€â”€ Performance_20250613.csv   # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ­ã‚°ï¼ˆæ—¥æ¬¡ï¼‰
â”œâ”€â”€ Security/
â”‚   â”œâ”€â”€ Authentication_20250613.log # èªè¨¼ãƒ­ã‚°ï¼ˆæ—¥æ¬¡ï¼‰
â”‚   â”œâ”€â”€ Access_20250613.log        # ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ï¼ˆæ—¥æ¬¡ï¼‰
â”‚   â””â”€â”€ Audit_20250613.json        # ç›£æŸ»ãƒ­ã‚°ï¼ˆæ—¥æ¬¡ã€JSONå½¢å¼ï¼‰
â””â”€â”€ Application/
    â”œâ”€â”€ API_Calls_20250613.csv     # APIå‘¼ã³å‡ºã—ãƒ­ã‚°ï¼ˆæ—¥æ¬¡ï¼‰
    â””â”€â”€ Reports_20250613.log       # ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ­ã‚°ï¼ˆæ—¥æ¬¡ï¼‰
```

#### ğŸ”„ è‡ªå‹•ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
```powershell
# ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
function Start-LogRotation {
    param(
        [string]$LogDirectory = "Logs",
        [int]$RetentionDays = 365
    )
    
    $cutoffDate = (Get-Date).AddDays(-$RetentionDays)
    
    Get-ChildItem -Path $LogDirectory -Recurse -File | 
    Where-Object {$_.LastWriteTime -lt $cutoffDate} | 
    ForEach-Object {
        Write-Host "å‰Šé™¤: $($_.FullName) (æœ€çµ‚æ›´æ–°: $($_.LastWriteTime))"
        Remove-Item $_.FullName -Force
    }
    
    # åœ§ç¸®ï¼ˆ30æ—¥ä»¥ä¸ŠçµŒéã—ãŸãƒ­ã‚°ï¼‰
    $compressDate = (Get-Date).AddDays(-30)
    Get-ChildItem -Path $LogDirectory -Recurse -File -Include "*.log", "*.csv" | 
    Where-Object {$_.LastWriteTime -lt $compressDate -and $_.Extension -ne ".zip"} | 
    ForEach-Object {
        $zipPath = $_.FullName.Replace($_.Extension, ".zip")
        Compress-Archive -Path $_.FullName -DestinationPath $zipPath
        Remove-Item $_.FullName -Force
        Write-Host "åœ§ç¸®: $($_.FullName) â†’ $zipPath"
    }
}

# ã‚¿ã‚¹ã‚¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã§ã®å®šæœŸå®Ÿè¡Œè¨­å®š
# æ¯æ—¥åˆå‰2æ™‚ã«å®Ÿè¡Œ
schtasks /create /tn "Microsoft365Tools-LogRotation" /tr "powershell.exe -File C:\Path\To\LogRotation.ps1" /sc daily /st 02:00 /ru SYSTEM
```

### ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆç®¡ç†

#### ğŸ“… ãƒ¬ãƒãƒ¼ãƒˆä¿å­˜ãƒãƒªã‚·ãƒ¼
```powershell
# ãƒ¬ãƒãƒ¼ãƒˆä¿å­˜æœŸé–“è¨­å®š
$ReportRetentionPolicy = @{
    Daily = @{
        RetentionDays = 30
        ArchiveAfterDays = 7
    }
    Weekly = @{
        RetentionDays = 365
        ArchiveAfterDays = 30
    }
    Monthly = @{
        RetentionDays = 1095  # 3å¹´
        ArchiveAfterDays = 90
    }
    Yearly = @{
        RetentionDays = 2555  # 7å¹´ï¼ˆæ³•çš„è¦ä»¶ï¼‰
        ArchiveAfterDays = 365
    }
}
```

#### ğŸ§¹ ãƒ¬ãƒãƒ¼ãƒˆã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
```powershell
function Start-ReportCleanup {
    $reportTypes = @("Daily", "Weekly", "Monthly", "Yearly")
    
    foreach ($type in $reportTypes) {
        $reportPath = "Reports\$type"
        $policy = $ReportRetentionPolicy[$type]
        
        # ä¿å­˜æœŸé–“ã‚’è¶…ãˆãŸãƒ¬ãƒãƒ¼ãƒˆã®å‰Šé™¤
        $deleteCutoff = (Get-Date).AddDays(-$policy.RetentionDays)
        Get-ChildItem -Path $reportPath -File | 
        Where-Object {$_.LastWriteTime -lt $deleteCutoff} | 
        Remove-Item -Force
        
        # ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å¯¾è±¡ã®ãƒ¬ãƒãƒ¼ãƒˆåœ§ç¸®
        $archiveCutoff = (Get-Date).AddDays(-$policy.ArchiveAfterDays)
        Get-ChildItem -Path $reportPath -File -Include "*.html", "*.csv" | 
        Where-Object {$_.LastWriteTime -lt $archiveCutoff -and $_.Extension -ne ".zip"} | 
        ForEach-Object {
            $zipPath = $_.FullName.Replace($_.Extension, ".zip")
            Compress-Archive -Path $_.FullName -DestinationPath $zipPath
            Remove-Item $_.FullName -Force
        }
    }
}
```

---

## ğŸš¨ ã‚¢ãƒ©ãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ

### âš ï¸ ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

#### ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆé–¾å€¤
```json
{
  "AlertThresholds": {
    "System": {
      "CPUUsage": 80,
      "MemoryUsage": 85,
      "DiskUsage": 90
    },
    "Application": {
      "APIFailureRate": 5,
      "ResponseTimeMs": 10000,
      "ConcurrentSessions": 10
    },
    "Business": {
      "MailboxCapacityWarning": 80,
      "OneDriveCapacityWarning": 85,
      "LicenseUsageWarning": 90
    }
  }
}
```

#### ğŸ“§ é€šçŸ¥è¨­å®š
```powershell
# SMTPã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥
function Send-AlertNotification {
    param(
        [string]$AlertType,
        [string]$Message,
        [string]$Severity = "Warning"
    )
    
    $smtpSettings = @{
        SmtpServer = "smtp.contoso.com"
        Port = 587
        UseSsl = $true
        Credential = Get-Credential # äº‹å‰ã«è¨­å®šã•ã‚ŒãŸèªè¨¼æƒ…å ±
    }
    
    $mailParams = @{
        To = "it-alerts@contoso.com"
        From = "microsoft365tools@contoso.com"
        Subject = "[$Severity] Microsoft 365çµ±åˆç®¡ç†ãƒ„ãƒ¼ãƒ« - $AlertType"
        Body = @"
ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿæ™‚åˆ»: $(Get-Date)
ã‚¢ãƒ©ãƒ¼ãƒˆç¨®åˆ¥: $AlertType
é‡è¦åº¦: $Severity
è©³ç´°: $Message

ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±:
- ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼å: $env:COMPUTERNAME
- ãƒ¦ãƒ¼ã‚¶ãƒ¼: $env:USERNAME
- PowerShellç‰ˆ: $($PSVersionTable.PSVersion)
"@
    }
    
    Send-MailMessage @mailParams @smtpSettings
}
```

### ğŸ› ï¸ ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œæ‰‹é †

#### ğŸ”„ ä¸€èˆ¬çš„ãªãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
```powershell
# 1. ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯
function Test-SystemHealth {
    $results = @{}
    
    # PowerShellç’°å¢ƒç¢ºèª
    $results.PowerShellVersion = $PSVersionTable.PSVersion
    $results.ExecutionPolicy = Get-ExecutionPolicy
    
    # å¿…é ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèª
    $requiredModules = @("Microsoft.Graph", "ExchangeOnlineManagement")
    $results.Modules = @{}
    foreach ($module in $requiredModules) {
        $results.Modules[$module] = Get-Module -ListAvailable $module | Select-Object Version
    }
    
    # æ¥ç¶šç¢ºèª
    $results.GraphConnection = Test-GraphAPIConnection
    $results.ExchangeConnection = Test-ExchangeOnlineConnection
    
    # ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ç¢ºèª
    $results.DiskSpace = Get-WmiObject -Class Win32_LogicalDisk -Filter "DeviceID='C:'" | 
                        Select-Object @{N="FreeGB";E={[math]::Round($_.FreeSpace/1GB,2)}}
    
    return $results
}

# 2. è‡ªå‹•ä¿®å¾©è©¦è¡Œ
function Start-AutoRepair {
    Write-Host "ğŸ”§ è‡ªå‹•ä¿®å¾©ã‚’é–‹å§‹ã—ã¾ã™..."
    
    # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    $modules = @("Microsoft.Graph", "ExchangeOnlineManagement")
    foreach ($module in $modules) {
        try {
            Remove-Module $module -Force -ErrorAction SilentlyContinue
            Import-Module $module -Force
            Write-Host "âœ… $module ã‚’å†ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ"
        }
        catch {
            Write-Warning "âŒ $module ã®å†ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: $($_.Exception.Message)"
        }
    }
    
    # æ¥ç¶šã®å†ç¢ºç«‹
    try {
        Disconnect-MgGraph -ErrorAction SilentlyContinue
        Disconnect-ExchangeOnline -Confirm:$false -ErrorAction SilentlyContinue
        Write-Host "âœ… æ—¢å­˜æ¥ç¶šã‚’åˆ‡æ–­ã—ã¾ã—ãŸ"
    }
    catch {
        Write-Warning "æ¥ç¶šåˆ‡æ–­æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸãŒã€ç¶šè¡Œã—ã¾ã™"
    }
}
```

---

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### âš¡ ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–

#### ğŸ’¾ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æœ€é©åŒ–
```powershell
# ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®å¼·åˆ¶å®Ÿè¡Œ
function Optimize-Memory {
    [System.GC]::Collect()
    [System.GC]::WaitForPendingFinalizers()
    [System.GC]::Collect()
    
    $memBefore = [System.GC]::GetTotalMemory($false) / 1MB
    $memAfter = [System.GC]::GetTotalMemory($true) / 1MB
    
    Write-Host "ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–å®Œäº†:"
    Write-Host "  å®Ÿè¡Œå‰: $([math]::Round($memBefore, 2)) MB"
    Write-Host "  å®Ÿè¡Œå¾Œ: $([math]::Round($memAfter, 2)) MB"
    Write-Host "  å‰Šæ¸›é‡: $([math]::Round($memBefore - $memAfter, 2)) MB"
}
```

#### ğŸ”„ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
```powershell
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
function Clear-ApplicationCache {
    if ($Global:APICache) {
        $cacheCount = $Global:APICache.Count
        $Global:APICache.Clear()
        Write-Host "âœ… APIã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ ($cacheCount é …ç›®)"
    }
    
    # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    $tempPath = Join-Path $env:TEMP "Microsoft365Tools"
    if (Test-Path $tempPath) {
        Remove-Item $tempPath -Recurse -Force
        Write-Host "âœ… ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ"
    }
}
```

### ğŸ“Š ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä½œæˆ

#### ğŸŒ HTMLç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
```powershell
function New-MonitoringDashboard {
    $systemHealth = Test-SystemHealth
    $resourceUsage = Get-SystemResourceUsage
    
    $html = @"
<!DOCTYPE html>
<html>
<head>
    <title>Microsoft 365çµ±åˆç®¡ç†ãƒ„ãƒ¼ãƒ« - ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="300"> <!-- 5åˆ†é–“éš”ã§è‡ªå‹•æ›´æ–° -->
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card h3 { margin-top: 0; color: #333; }
        .status-ok { color: #28a745; }
        .status-warning { color: #ffc107; }
        .status-error { color: #dc3545; }
        .metric { display: flex; justify-content: space-between; margin: 10px 0; }
        .progress-bar { width: 100%; height: 20px; background-color: #e9ecef; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.3s ease; }
        .progress-ok { background-color: #28a745; }
        .progress-warning { background-color: #ffc107; }
        .progress-error { background-color: #dc3545; }
    </style>
</head>
<body>
    <h1>ğŸ“Š Microsoft 365çµ±åˆç®¡ç†ãƒ„ãƒ¼ãƒ« - ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
    <p>æœ€çµ‚æ›´æ–°: $(Get-Date -Format "yyyyå¹´MMæœˆddæ—¥ HH:mm:ss")</p>
    
    <div class="dashboard">
        <div class="card">
            <h3>ğŸ–¥ï¸ ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹</h3>
            <div class="metric">
                <span>CPUä½¿ç”¨ç‡:</span>
                <span class="$( if($resourceUsage.CPUUsage -lt 70) {'status-ok'} elseif($resourceUsage.CPUUsage -lt 85) {'status-warning'} else {'status-error'} )">
                    $($resourceUsage.CPUUsage)%
                </span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill $( if($resourceUsage.CPUUsage -lt 70) {'progress-ok'} elseif($resourceUsage.CPUUsage -lt 85) {'progress-warning'} else {'progress-error'} )" 
                     style="width: $($resourceUsage.CPUUsage)%"></div>
            </div>
            
            <div class="metric">
                <span>ä½¿ç”¨å¯èƒ½ãƒ¡ãƒ¢ãƒª:</span>
                <span class="status-ok">$($resourceUsage.AvailableMemoryMB) MB</span>
            </div>
            
            <div class="metric">
                <span>ãƒ‡ã‚£ã‚¹ã‚¯ç©ºãå®¹é‡:</span>
                <span class="status-ok">$($resourceUsage.DiskFreeSpaceGB) GB</span>
            </div>
        </div>
        
        <div class="card">
            <h3>ğŸŒ APIæ¥ç¶šçŠ¶æ³</h3>
            <div class="metric">
                <span>Microsoft Graph:</span>
                <span class="$( if($systemHealth.GraphConnection.Status -eq 'Connected') {'status-ok'} else {'status-error'} )">
                    $($systemHealth.GraphConnection.Status)
                </span>
            </div>
            <div class="metric">
                <span>Exchange Online:</span>
                <span class="$( if($systemHealth.ExchangeConnection.Status -eq 'Connected') {'status-ok'} else {'status-error'} )">
                    $($systemHealth.ExchangeConnection.Status)
                </span>
            </div>
        </div>
        
        <div class="card">
            <h3>ğŸ“¦ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çŠ¶æ³</h3>
            <div class="metric">
                <span>Microsoft.Graph:</span>
                <span class="status-ok">$(if($systemHealth.Modules['Microsoft.Graph']) {'ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿'} else {'æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«'})</span>
            </div>
            <div class="metric">
                <span>ExchangeOnlineManagement:</span>
                <span class="status-ok">$(if($systemHealth.Modules['ExchangeOnlineManagement']) {'ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿'} else {'æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«'})</span>
            </div>
        </div>
    </div>
</body>
</html>
"@
    
    $dashboardPath = "Reports\System\MonitoringDashboard_$(Get-Date -Format 'yyyyMMdd_HHmmss').html"
    $html | Out-File -FilePath $dashboardPath -Encoding UTF8
    
    Write-Host "ğŸ“Š ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸ: $dashboardPath"
    return $dashboardPath
}
```

---

## ğŸ“š é‹ç”¨æ‰‹é †æ›¸

### ğŸŒ… æ—¥æ¬¡é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### âœ… æ¯æ—¥ã®ç¢ºèªäº‹é …
- [ ] ğŸ–¥ï¸ **ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ç¢ºèª**: CPU/ãƒ¡ãƒ¢ãƒª/ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡
- [ ] ğŸŒ **APIæ¥ç¶šçŠ¶æ³ç¢ºèª**: Graph APIãƒ»Exchange Onlineæ¥ç¶š
- [ ] ğŸ“ **ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç¢ºèª**: æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ã‚„ãƒ¯ãƒ¼ãƒ‹ãƒ³ã‚°ã®æœ‰ç„¡
- [ ] ğŸ“Š **ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆç¢ºèª**: æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã®æ­£å¸¸ç”Ÿæˆ
- [ ] ğŸ”’ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°ç¢ºèª**: ä¸å¯©ãªã‚¢ã‚¯ã‚»ã‚¹ã‚„ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—

#### ğŸ”§ æ—¥æ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
```powershell
# æ—¥æ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
function Start-DailyMaintenance {
    Write-Host "ğŸŒ… æ—¥æ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’é–‹å§‹ã—ã¾ã™..."
    
    # 1. ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯
    $health = Test-SystemHealth
    Write-Host "âœ… ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯å®Œäº†"
    
    # 2. ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡ç¢ºèª
    $resources = Get-SystemResourceUsage
    Write-Host "âœ… ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡ç¢ºèªå®Œäº†"
    
    # 3. ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
    Start-LogRotation -RetentionDays 365
    Write-Host "âœ… ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†"
    
    # 4. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
    Clear-ApplicationCache
    Write-Host "âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢å®Œäº†"
    
    # 5. ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”Ÿæˆ
    $dashboardPath = New-MonitoringDashboard
    Write-Host "âœ… ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”Ÿæˆå®Œäº†: $dashboardPath"
    
    Write-Host "ğŸ‰ æ—¥æ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Œäº†"
}
```

### ğŸ“… é€±æ¬¡é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### âœ… æ¯é€±ã®ç¢ºèªäº‹é …
- [ ] ğŸ”’ **è¨¼æ˜æ›¸æœ‰åŠ¹æœŸé™ç¢ºèª**: 30æ—¥ä»¥å†…ã«æœŸé™åˆ‡ã‚Œã®è¨¼æ˜æ›¸ç¢ºèª
- [ ] ğŸ“ˆ **é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆç¢ºèª**: å‚¾å‘åˆ†æã¨ç•°å¸¸å€¤ã®ç¢ºèª
- [ ] ğŸ›¡ï¸ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»**: ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®è©³ç´°åˆ†æ
- [ ] ğŸ“¦ **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ›´æ–°ç¢ºèª**: PowerShellãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ›´æ–°æœ‰ç„¡
- [ ] ğŸ’¾ **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¢ºèª**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ»é‡è¦ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

### ğŸ“† æœˆæ¬¡é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### âœ… æ¯æœˆã®ç¢ºèªäº‹é …
- [ ] ğŸ“Š **æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆåˆ†æ**: è©³ç´°ãªåˆ©ç”¨çŠ¶æ³ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
- [ ] ğŸ’° **å¹´é–“æ¶ˆè²»å‚¾å‘ç¢ºèª**: äºˆç®—ã¨ã®ç…§åˆãƒ»äºˆæ¸¬åˆ†æ
- [ ] ğŸ”„ **ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒãƒ»æ©Ÿèƒ½æ›´æ–°ã®é©ç”¨
- [ ] ğŸ“‹ **ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ç›£æŸ»**: ISOæº–æ‹ çŠ¶æ³ã®ç¢ºèª
- [ ] ğŸ§¹ **ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ä¸è¦ãªãƒ­ã‚°ãƒ»ãƒ¬ãƒãƒ¼ãƒˆã®å‰Šé™¤

---

**ğŸ¯ é©åˆ‡ãªé‹ç”¨ç®¡ç†ã«ã‚ˆã‚Šã€Microsoft 365çµ±åˆç®¡ç†ãƒ„ãƒ¼ãƒ«ã®å®‰å®šç¨¼åƒã¨æœ€å¤§åŠ¹æœã‚’å®Ÿç¾ã—ã¾ã—ã‚‡ã†ï¼**

---

*ğŸ“… æœ€çµ‚æ›´æ–°: 2025å¹´6æœˆ | ğŸ› ï¸ ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…å‘ã‘é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ« v1.0*