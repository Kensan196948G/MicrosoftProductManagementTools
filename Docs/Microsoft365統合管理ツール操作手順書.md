# 📖 Microsoft 365統合管理ツール 操作手順書

## 🎯 概要
PowerShellバージョンに応じて最適なメニューインターフェースを自動選択する、使いやすい統合管理ツールです。

---

## 🚀 基本的な起動手順

### 📋 手順1: PowerShellの起動
1. 🔍 **Windowsメニューから「PowerShell」を検索**
2. 🖱️ **「Windows PowerShell」または「PowerShell 7」を右クリック**
3. ⚡ **「管理者として実行」を選択**
4. 🛡️ **UACダイアログで「はい」をクリック**

### 📂 手順2: 作業ディレクトリへの移動
1. 📁 **以下のコマンドを入力してEnterキーを押す**
   ```powershell
   cd "E:\MicrosoftProductManagementTools"
   ```
2. ✅ **プロンプトが変わったことを確認**

### 🎮 手順3: 管理ツールの起動

#### 🔧 方法A: 自動選択（推奨）
```powershell
.\Start-ManagementTools.ps1
```
- 🤖 **PowerShell環境を自動判定**
- 🎯 **最適なメニューを自動選択**
- 🛡️ **エラー時は自動的にフォールバック**

#### ⚙️ 方法B: メニュータイプを指定
```powershell
# CLIメニューを強制使用
.\Start-ManagementTools.ps1 -MenuType CLI

# ConsoleGUIメニューを使用（PowerShell 7推奨）
.\Start-ManagementTools.ps1 -MenuType ConsoleGUI
```

---

## 🖥️ PowerShell 5.1でのCLIメニュー操作

### 📋 メニュー画面の見方
```
╔══════════════════════════════════════════════════════════════════════╗
║                Microsoft 365 統合管理システム                       ║
║             ITSM/ISO27001/27002準拠 エンタープライズ管理             ║
╚══════════════════════════════════════════════════════════════════════╝

【基本機能】 - 日常運用で使用する基本的な管理機能
────────────────────────────────────────────────────────
   1. AD連携とユーザー同期状況確認 [管理者権限必要]
       └ Active DirectoryとEntra IDの同期状況を確認

   2. Exchangeメールボックス容量監視
       └ Exchange Onlineメールボックスの容量使用状況を監視
```

### 🎯 操作方法
1. 🔢 **番号を入力**（例: `1`）
2. ⏎ **Enterキーを押す**
3. ⏳ **処理完了まで待機**
4. ⏎ **続行する場合はEnterキーを押す**

### 🗺️ ナビゲーション操作
- 🔠 **H**: ヘルプ表示
- 🔄 **R**: メニューを最新情報に更新
- ❌ **Q**: ツールを終了

---

## 🎨 PowerShell 7でのConsoleGUIメニュー操作

### 🛠️ 事前準備（初回のみ）
1. 📦 **必要モジュールのインストール**
   ```powershell
   Install-Module Microsoft.PowerShell.ConsoleGuiTools -Force
   ```
2. ✅ **インストール完了を確認**

### 🖱️ GUIメニューの操作手順

#### 📂 手順1: カテゴリ選択
1. 🎯 **カテゴリ選択画面が表示される**
   ```
   📋 カテゴリを選択してください
   ┌─────────────────────────────────────┐
   │ 🏢 Active Directory                 │
   │ 📧 Exchange Online                  │
   │ 👥 Teams & OneDrive                 │
   │ 📊 レポート機能                    │
   │ 🔒 セキュリティ・コンプライアンス  │
   │ 💰 年間消費傾向・予算管理          │
   │ ⚙️ システム管理                    │
   └─────────────────────────────────────┘
   ```

2. ⬆️⬇️ **矢印キーでカテゴリを選択**
3. ⏎ **Enterキーで決定**
4. ❌ **Escキーでキャンセル可能**

#### 🎯 手順2: タスク選択
1. 📋 **選択したカテゴリのタスク一覧が表示**
   ```
   📋 実行するタスクを選択してください - 📧 Exchange Online
   ┌─────────────────────────────────────────────────────┐
   │ ID     │ Task                    │ Description      │
   │ EXO001 │ メールボックス容量監視  │ Exchange Online… │
   │ EXO002 │ 添付ファイル分析        │ 大容量添付ファ… │
   │ EXO003 │ スパムフィルター分析    │ スパムフィルタ… │
   └─────────────────────────────────────────────────────┘
   ```

2. ⬆️⬇️ **矢印キーでタスクを選択**
3. 🔍 **Ctrl+Fで検索・フィルタリング可能**
4. ⏎ **Enterキーで決定**

#### ✅ 手順3: 実行確認
1. 📝 **タスク詳細が表示される**
   ```
   選択されたタスク:
     ID: EXO001
     タスク: メールボックス容量監視
     説明: Exchange Onlineメールボックスの容量使用状況監視
     ⚠️ このタスクは管理者権限が必要です
   ```

2. ✅ **実行確認**: `Y` を入力してEnter
3. ❌ **キャンセル**: `N` を入力してEnter

#### 🔄 手順4: 継続・終了選択
1. ✅ **メニュー続行**: `Y` を入力してEnter
2. 🚪 **ツール終了**: `N` を入力してEnter

---

## 🔧 高度な起動オプション

### 📊 システム情報表示
```powershell
# 環境情報とシステム状況を表示
.\Start-ManagementTools.ps1 -Mode Info
```
**表示内容:**
- 💻 PowerShell環境情報
- 🎯 推奨メニュータイプ
- 📦 インストール済みモジュール状況
- 🔤 Unicode文字サポート状況

### 🧪 システムテスト
```powershell
# システムの健全性をテスト
.\Start-ManagementTools.ps1 -Mode Test
```
**チェック項目:**
- ✅ PowerShellバージョン確認
- 📦 必須モジュール確認
- 📄 設定ファイル確認

### 🔍 詳細情報付き起動
```powershell
# 環境情報を表示してからメニュー起動
.\Start-ManagementTools.ps1 -ShowInfo
```

### ⚡ 強制実行
```powershell
# 前提条件チェックをスキップして強制実行
.\Start-ManagementTools.ps1 -Force
```

---

## 🎯 主要機能の操作手順

### 📊 年間消費傾向アラート（人気機能）

#### 🖥️ CLIメニューの場合
1. 🔢 **メニューで「6」を選択**
2. 💰 **年間予算上限を入力**（例: `5000000`）
3. ⚠️ **アラート閾値を入力**（例: `80`）
4. ⏳ **分析完了まで待機**
5. 📊 **結果確認とレポート表示**

#### 🎨 ConsoleGUIメニューの場合
1. 💰 **「年間消費傾向・予算管理」カテゴリを選択**
2. 📈 **「年間消費傾向アラート」タスクを選択**
3. ⚙️ **設定オプションを選択**:
   - 🔧 **デフォルト設定**: 予算¥5,000,000、閾値80%
   - ✏️ **カスタム設定**: 手動でパラメータ入力
4. 📊 **分析結果確認**
5. 🌐 **HTMLレポートを開くか選択**

### 📋 レポート生成

#### 📅 定期レポート
1. 📊 **「レポート機能」を選択**
2. 📆 **レポート種類を選択**:
   - 🌅 **日次**: 日常監視項目
   - 📅 **週次**: 週間サマリー
   - 📆 **月次**: 月間分析
   - 📈 **年次**: 年間統計
3. ⏳ **生成完了まで待機**
4. 📁 **`Reports`フォルダで結果確認**

---

## ⚠️ トラブルシューティング

### 🚫 よくあるエラーと対処法

#### ❌ "実行ポリシーエラー"
```powershell
# 実行ポリシーを変更
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

#### ❌ "モジュールが見つからない"
```powershell
# 必要モジュールをインストール
Install-Module Microsoft.Graph -Force
Install-Module ExchangeOnlineManagement -Force
Install-Module Microsoft.PowerShell.ConsoleGuiTools -Force
```

#### ❌ "文字化けが発生"
1. 🔧 **CLIメニューに切り替え**
   ```powershell
   .\Start-ManagementTools.ps1 -MenuType CLI
   ```
2. 🔤 **コンソール設定でフォントをConsolasに変更**

#### ❌ "ConsoleGUIが動作しない"
1. 🔍 **PowerShell 7かを確認**
   ```powershell
   $PSVersionTable.PSVersion
   ```
2. 📦 **ConsoleGuiToolsモジュール確認**
   ```powershell
   Get-Module -ListAvailable Microsoft.PowerShell.ConsoleGuiTools
   ```

### 🆘 緊急時の対処

#### 🔄 レガシーメニューへのフォールバック
- ✅ **システムが自動的に安全なCLIメニューに切り替え**
- 🛡️ **基本機能は常に利用可能**

#### 📞 サポート情報表示
```powershell
# ヘルプ情報を表示（CLIメニュー内）
H [Enter]
```

---

## 💡 効率的な使い方のコツ

### 🔥 推奨ワークフロー
1. 🌅 **朝一番**: 日次レポート確認
2. 📊 **週初め**: 週次レポートで傾向確認
3. 💰 **月末**: 年間消費傾向アラートで予算確認
4. 🔒 **定期**: セキュリティ監査実行

### ⚡ 時短テクニック
- 🎯 **PowerShell 7 + ConsoleGUI**: 最も効率的
- 🔍 **Ctrl+F**: 機能の素早い検索
- 🏃‍♂️ **自動選択モード**: 環境に最適化

### 📚 学習リソース
- 🎮 **テストモード**: 安全な動作確認
- 📊 **環境情報**: システム理解
- 📖 **ヘルプ機能**: 詳細な操作説明

---

## ✅ チェックリスト

### 🚀 初回セットアップ
- [ ] 🔧 PowerShell管理者権限で起動
- [ ] 📁 正しいディレクトリに移動
- [ ] 📦 必要モジュールのインストール確認
- [ ] 🧪 システムテスト実行
- [ ] ✅ 基本メニュー動作確認

### 📅 日常使用
- [ ] 🌅 日次レポート確認
- [ ] 📧 メールボックス容量監視
- [ ] ☁️ OneDrive/Teams使用状況確認
- [ ] 🔒 セキュリティ状況確認

### 🔄 定期保守
- [ ] 📅 週次レポート生成・確認
- [ ] 📆 月次レポート生成・確認
- [ ] 💰 年間消費傾向アラート実行
- [ ] 🧹 ログクリーンアップ

---

**🎉 これで Microsoft 365統合管理ツールを効率的に活用できます！**